---
import { Image } from 'astro:assets';
import taichiLogo from '../../assets/image/taichi-logo.png';
import { localizedPath } from '../../lib/paths';

const currentPath = Astro.url.pathname;

// Determine current locale from path
const getLocaleFromPath = (path: string): 'nl' | 'en' | 'zh' => {
  if (path.startsWith('/en/')) return 'en';
  if (path.startsWith('/zh/')) return 'zh';
  return 'nl'; // default locale
};

const currentLocale = getLocaleFromPath(currentPath);
const coursesPath = localizedPath('/courses', currentLocale);
const anchor = currentLocale === 'zh' ? '#报名表单' : (currentLocale === 'en' ? '#registration-form' : '#inschrijvingsformulier');
const ctaHref = coursesPath + anchor;
const shouldShow = !currentPath.includes('/courses');
---

<!-- Floating CTA Button -->
{shouldShow && (
  <div class="fixed right-6 bottom-6 z-50 floating-cta">
    <a
      href={ctaHref}
      class="group block relative"
      aria-label={currentLocale === 'zh' ? '立即报名' : (currentLocale === 'en' ? 'Register Now' : 'Direct Inschrijven')}
    >
      <!-- Tai Chi Logo Container -->
      <div class="w-16 h-16 border-accent/30 rounded-full shadow-2xl hover:shadow-3xl transition-all duration-300 hover:scale-110 flex items-center justify-center">
        <Image
          src={taichiLogo}
          alt="Tai Chi"
          width={64}
          height={64}
          class="w-12 h-12 object-contain animate-spin"
          style="animation-duration: 8s;"
          format="png"
        />
      </div>

      <!-- Tooltip -->
      <div class="absolute right-full mr-3 top-1/2 -translate-y-1/2 px-3 py-1 text-sm font-medium rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 whitespace-nowrap pointer-events-none">
        {currentLocale === 'zh' ? '立即报名' : (currentLocale === 'en' ? 'Register Now' : 'Direct Inschrijven')}
      </div>
    </a>
  </div>
)}

<style>
  /* Floating button animation */
  .floating-cta {
    animation: slideInRight 0.6s ease-out;
  }

  @keyframes slideInRight {
    from {
      opacity: 0;
      transform: translateX(100px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  /* Mobile optimization */
  @media (max-width: 640px) {
    .floating-cta {
      right: 1.25rem;
      bottom: 1.25rem;
    }

    .floating-cta .w-16 {
      width: 3.5rem;
      height: 3.5rem;
    }
  }

  /* Pause animation on hover */
  .floating-cta a:hover {
    animation-play-state: paused;
  }
</style>

<script>
  // Scroll-based show/hide effect
  let lastScrollY = window.scrollY;
  const cta = document.querySelector('.floating-cta');

  window.addEventListener('scroll', () => {
    if (window.scrollY > 300) {
      cta?.classList.remove('opacity-0', 'pointer-events-none');
      cta?.classList.add('opacity-100');
    } else {
      cta?.classList.add('opacity-0', 'pointer-events-none');
      cta?.classList.remove('opacity-100');
    }
    lastScrollY = window.scrollY;
  }, { passive: true });
</script>
